<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.test.mvc.IArticleReportDAO">

	<select id="lists" resultType="com.test.mvc.ArticleReportDTO">
		SELECT M2.MEMBER_ID AS WRITER_ID
		     , M2.MEMBER_CODE AS WRITER_CODE
		     , ARO.ARTICLE_REP_OUT_PROCESS
		     , ARI.ARTICLE_REP_IN_CODE
		     , RT.REP_TYPE_CODE AS REP_TYPE_CODE
		     , REP_TYPE_DETAIL
		     , A.ARTICLE_CODE
		     , A.BNO
		     , ARI.ARTICLE_REP_IN_CONTENT
		     , M.MEMBER_CODE AS REPORTER_CODE
		     , M.MEMBER_ID AS REPORTER_ID
		     , ARO.ARTICLE_REP_OUT_CODE
		     , ARTICLE_REP_IN_DATE
		     , ARTICLE_REP_OUT_DATE
		FROM ARTICLE_REP_IN ARI LEFT JOIN REP_TYPE RT
		ON ARI.REP_TYPE_CODE = RT.REP_TYPE_CODE
		LEFT JOIN MEMBER M
		ON ARI.MEMBER_CODE = M. MEMBER_CODE
		LEFT JOIN ARTICLE A 
		ON ARI.ARTICLE_CODE = A.ARTICLE_CODE
		LEFT JOIN ARTICLE_REP_OUT ARO
		ON ARI.ARTICLE_REP_IN_CODE = ARO.ARTICLE_REP_IN_CODE
		LEFT JOIN MEMBER M2
		ON A.MEMBER_CODE = M2.MEMBER_CODE
	</select>
	
	<insert id="reportProcess">
		INSERT INTO ARTICLE_REP_OUT(ARTICLE_REP_OUT_CODE, ARTICLE_REP_IN_CODE, MEMBER_CODE, ARTICLE_REP_OUT_DATE, ARTICLE_REP_OUT_PROCESS)
		VALUES('ARO' || ARTICLE_REP_OUT_SEQ.NEXTVAL, #{article_rep_in_code}, #{memberCode}, SYSDATE, ${article_rep_out_process})
	</insert>
	
	<select id="totalReportedById" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM ARTICLE_REP_IN ARI LEFT JOIN REP_TYPE RT
		ON ARI.REP_TYPE_CODE = RT.REP_TYPE_CODE
		LEFT JOIN MEMBER M
		ON ARI.MEMBER_CODE = M. MEMBER_CODE
		LEFT JOIN ARTICLE A 
		ON ARI.ARTICLE_CODE = A.ARTICLE_CODE
		LEFT JOIN ARTICLE_REP_OUT ARO
		ON ARI.ARTICLE_REP_IN_CODE = ARO.ARTICLE_REP_IN_CODE
		LEFT JOIN MEMBER M2
		ON A.MEMBER_CODE = M2.MEMBER_CODE
		WHERE ARTICLE_REP_OUT_PROCESS = 0 AND M2.MEMBER_ID = #{id}
	</select>

</mapper>